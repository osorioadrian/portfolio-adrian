---
interface FormText {
    name: string
    email: string
    subject: string
    message: string
    send: string
}

interface ContactText {
    subtitle: string
    title: string
    description: string
    cv: string,
    message: string
    thank: string
    send: string
    form: FormText
}

interface Props {
  contact: ContactText
}

const { contact } = Astro.props
---

<section id="contact" class="bg-[#F9F9F9] py-24 px-8 max-w-7xl mx-auto scroll-mt-20 font-sans">
  <div class="grid grid-cols-1 lg:grid-cols-[1fr_auto] gap-16 items-start">
    
    <div class="space-y-8">
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 bg-black rounded-full"></span>
        <span class="text-sm font-medium tracking-wider">{contact.subtitle}</span>
      </div>
      
      <h2 class="text-5xl md:text-6xl font-bold tracking-tight text-black leading-[1.1] max-w-xl">
        {contact.title}
      </h2>
      
      <p class="text-lg text-gray-500 max-w-md leading-relaxed">
        {contact.description}
      </p>
    </div>

    <div class="flex flex-col md:flex-row gap-8 items-start">
      
      <div id="form-card" class="bg-white border border-gray-100 rounded-[2.5rem] p-10 shadow-xl shadow-gray-100/50 w-full md:w-112.5 min-h-130 flex flex-col justify-center">
        
        <form 
          id="contact-form"
          action="https://formspree.io/f/xbddddkw" 
          method="POST"
          class="space-y-6"
        >
          <div class="grid grid-cols-2 gap-4">
            <div class="space-y-2">
              <label class="text-sm font-bold text-black ml-1">{contact.form.name}</label>
              <input required name="name" type="text" placeholder={contact.form.name} class="contact-input w-full bg-[#F9F9F9] rounded-xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-black/5" />
            </div>
            <div class="space-y-2 text-right">
               <span class="text-[10px] bg-gray-200 px-3 py-1 rounded-full text-gray-500 font-bold uppercase">{contact.form.email}</span>
               <input required name="email" type="email" placeholder="mail@example.com" class="contact-input w-full bg-[#F9F9F9] rounded-xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-black/5" />
            </div>
          </div>

          <div class="space-y-2">
            <label class="text-sm font-bold text-black ml-1">{contact.form.subject}</label>
            <input required name="subject" type="text" placeholder="..." class="contact-input w-full bg-[#F9F9F9] rounded-xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-black/5" />
          </div>

          <div class="space-y-2">
            <textarea required name="message" rows="4" placeholder={contact.form.message} class="contact-input w-full bg-[#F9F9F9] rounded-2xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-black/5 resize-none"></textarea>
          </div>

          <button 
            id="submit-btn"
            type="submit" 
            disabled
            class="w-full bg-[#4A4E57] disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-xl hover:bg-black transition-all duration-300 flex justify-center items-center gap-3"
          >
            <span id="btn-text">{contact.form.send}</span>
            <div id="btn-loader" class="hidden w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
          </button>
        </form>

        <div id="success-message" class="hidden text-center space-y-6 animate-fade-in">
            <div class="bg-green-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
            </div>
            <h3 class="text-2xl font-bold text-black">{contact.message}</h3>
            <p class="text-gray-500">{contact.thank}</p>
            <button onclick="window.location.reload()" class="text-sm font-bold text-gray-400 hover:text-black transition-colors underline">{contact.send}</button>
        </div>
      </div>

      <div class="flex flex-col gap-4 w-full md:w-56">
  
        <a 
          href="https://wa.me/573112256300?text=Hola%20Adrian,%20vi%20tu%20portafolio%20y%20me%20gustaría%20contactarte." 
          target="_blank"
          class="bg-white border border-gray-100 p-5 rounded-4xl shadow-sm hover:shadow-md transition-all duration-300 flex items-center justify-between group"
        >
          <div class="flex items-center gap-3">
            <div class="bg-[#F9F9F9] p-3 rounded-full group-hover:bg-green-50 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 group-hover:text-green-600">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
            </div>
            <span class="text-sm font-bold text-black">WhatsApp</span>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-300 group-hover:translate-x-1 transition-transform">
            <path d="M7 7h10v10"/><path d="M7 17L17 7"/>
          </svg>
        </a>

        <a 
          href="/AdrianCamiloOsorio.pdf" 
          download
          class="bg-white border border-gray-100 p-5 rounded-4xl shadow-sm hover:shadow-md transition-all duration-300 flex items-center justify-between group"
        >
          <div class="flex items-center gap-3">
            <div class="bg-[#F9F9F9] p-3 rounded-full group-hover:bg-blue-50 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 group-hover:text-blue-600">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>
              </svg>
            </div>
            <span class="text-sm font-bold text-black">{contact.cv}</span>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-300 group-hover:translate-y-1 transition-transform"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
        </a>

      </div>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const btn = document.getElementById('submit-btn') as HTMLButtonElement;
  const btnText = document.getElementById('btn-text');
  const btnLoader = document.getElementById('btn-loader');
  const successMsg = document.getElementById('success-message');
  const inputs = document.querySelectorAll('.contact-input') as NodeListOf<HTMLInputElement | HTMLTextAreaElement>;

  // Función para validar campos en tiempo real
  function validate() {
    const allFilled = Array.from(inputs).every(i => i.value.trim() !== '');
    const emailInput = form.querySelector('input[type="email"]') as HTMLInputElement;
    btn.disabled = !(allFilled && emailInput.checkValidity());
  }

  inputs.forEach(input => input.addEventListener('input', validate));

  // Envío AJAX
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // UI Loading
    btn.disabled = true;
    btnText!.textContent = 'Enviando...';
    btnLoader!.classList.remove('hidden');

    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: form.method,
        body: formData,
        headers: { 'Accept': 'application/json' }
      });

      if (response.ok) {
        form.classList.add('hidden');
        successMsg!.classList.remove('hidden');
      } else {
        alert("Algo salió mal. Por favor, revisa los datos.");
        btnText!.textContent = 'Intentar de nuevo';
      }
    } catch (err) {
      alert("Error de red.");
    } finally {
      btnLoader!.classList.add('hidden');
    }
  });
</script>

<style>
  .animate-fade-in {
    animation: fadeIn 0.4s ease-out forwards;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
</style>